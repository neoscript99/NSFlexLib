<?xml version="1.0" encoding="utf-8"?>
<mx:HDividedBox xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%"
				xmlns:controls="ns.flex.controls.*"
				addedToStage="stage.addEventListener(MouseEvent.CLICK, onStageClick)"
				creationComplete="cc()">
	<mx:Metadata>
		[Event(name="windowClose")]
		[Event(name="timerComplete")]
	</mx:Metadata>
	<mx:Script>
		<![CDATA[
			import ns.flex.util.MessageUtil;
			import mx.core.Container;
			import mx.containers.ViewStack;
			import mx.managers.HistoryManager;
			private var _historyManager:HistoryManager;
			[Bindable]
			public var menus:XML;
			public var spareMintues:int;
			public var views:ViewStack;
			private var timer:Timer;

			private function cc():void
			{
				if (spareMintues > 0)
				{
					timer=new Timer(60 * 1000, spareMintues);
					timer.start();
					timer.addEventListener(TimerEvent.TIMER_COMPLETE,
						function timerComplete(e:Event):void
						{
							dispatchEvent(new Event('timerComplete'));
						});
				}
				appWindow.addChild(views);
			}

			private function onStageClick(e:MouseEvent):void
			{
				trace('x: ', e.stageX, ' y: ', e.stageY);
				if (timer)
				{
					trace('timer delay:', timer.delay, 'currentCount: ',
						timer.currentCount);
					timer.reset();
					timer.start();
				}
			}

			private function switchMenu():void
			{
				if (hdb.numChildren > 1)
					hdb.removeChild(menuPanel);
				else
					hdb.addChildAt(menuPanel, 0);
			}

			//用上下键切换菜单时，可能由于SWFLoader未及时完成的原因，报空指针错误
			//Flex官方sample：Explorer，也存在同样的问题。
			//所以把键盘事件屏蔽,并且每次初始化一个SWFLoader实例
			private function menuClick():void
			{
				if (!menuTree.selectedItem)
					return;
				var nodeApp:String=menuTree.selectedItem.@app;

				if (nodeApp)
				{
					views.selectedIndex=views.getChildIndex(views.getChildByName(nodeApp));
					appWindow.title=menuTree.selectedItem.@label;
				}
				else
					menuTree.expandItem(menuTree.selectedItem,
						!menuTree.isItemOpen(menuTree.selectedItem), true);

			}
		]]>
	</mx:Script>
	<mx:HDividedBox id="hdb" width="100%" height="100%">
		<mx:Panel id="menuPanel" width="200" height="100%" title="菜单">
			<mx:Tree id="menuTree" width="100%" height="100%" wordWrap="false"
					 showRoot="false" dataProvider="{menus.node}" labelField="@label"
					 click="menuClick()"/>
		</mx:Panel>
		<controls:TitleWindowPlus id="appWindow" width="100%" height="100%"
								  showCloseButton="true"
								  close="dispatchEvent(new Event('windowClose'))"
								  titleDoubleClick="switchMenu()">
		</controls:TitleWindowPlus>
	</mx:HDividedBox>
</mx:HDividedBox>
